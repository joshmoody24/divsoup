defmodule Divsoup.Achievement.ZalgoTest do
  use ExUnit.Case
  import Divsoup.AchievementTest.Helper

  alias Divsoup.Achievement.Zalgo

  test "earns achievement with zalgo text" do
    # Creating some zalgo text with combining diacritical marks
    # Note: The text might appear corrupted in the source code editor
    html = """
    <html>
      <head>
        <title>Zalgo Test</title>
      </head>
      <body>
        <div>
          <p>This page contains z̸̢̧̡̧̢̨̡̢̡̧̛̛̛̦̻̙͙̜̼̫̘̹͎̩̗̯̤̙̝̦͚̱͎͔̩̥̼̤͈̝̻̗̠̞̮̩̜̰̠̙̥̹̲̦̦͔̮̯̥̰̹͎͔̱̝̯̰̻͍̞̹̻̤̬̺̻͔̪̙̤̤͍̙̫̰̘̱͓̮̙̲̼̲͕͙̟̟̫̦̬̙͔̈́̀͊͒̿́̾̓̊̂̽͊̓̿̽̍̍̒̇̅͆̊̌́̋̋̓͊̉͒̓̿̆̌̽̅̀̏̉͛̍̀̿̾̽̔̒̉̽͆̄̏͋͌̿̀͗̄̏͐̈́̿̇̊̀̍̅̇͆̄̈́̊̓̈̓̌̐͊͊̀̆̌̐̈̂̂͗̓̈́̋͂͑̋̈́̌̎̀͋̊͋̿̒̾͊̀̒̏̆́̑́̀̉̄̅͐́̓̐̃̚̕̕̚̕̚̚̚͘̚͜͜͝͝͝͝͝͝͝͝͝͠ͅͅͅa̷̧̧̡̨̧̢̨̢̧̛̛̛̛̱̗̞̮͓̯̮̬̱̱̙̤̗̻̪̯̝̬͔̠͍̘̯̥̮͎̭̙͖̯̤̞̣̹̟̮̲̳̰̖̣̦̲̥̱̥̰̠͕̲̟̖̣͍͍̬̙̝̪̩̰̲̮̘̤̙̥̳̙͙̝̙͙̱̙̺̪̫͔̬̘̬̻͇͔̘͇̣̥͕̝̼̭̭̪͇̠̩̲̼̦͆̓̎̌̉̀͑̈́̓̏͊͗̀̂̑̈́̑̏̏̓͐̉̎̿͑͑͆̋͂͒͆̄̈́͑̄͂͌̑̿͑̆͗̏̑̓̑̇͂͌̎͑̓̒̌̆̌̑͗̆͆̌̿̋̾̒̊̿̈́̾͋̋̋̓̎̏͋̈́̆̽͋̊̓͑̊̀̃̀̎̈̇̍̈́̽̈́̈́̇͑̓̑̀͑̂̿̂͂̚͘̚̚̚̚̚̕͘͘͜͜͜͝͝͝͝͝͝͝͝͝ͅͅͅļ̸̨̛̛̯̰̹̖̱̞̹̹̹̜̦͉̙̼͕̲̬̭̳̯̮͍̗̝̞͈̻̙̣͍̰̻̯̦̫̼̺̝̞͓̝͐̓̓͂͒̂̅̑̾̊͐̄͂̾̏̎͒͌̑̾̆͒̽͋̂̎̂̇͑̏̉̓͒̒̽̄̔̿́͑͒̌̌͂̊̈́̃̒̓̄̾̒̂̂̃̓̔̌͋͒̓͌̈͗̍̒̄̏̈́̐͒̏̍̏̑̀̽̃̏̓̓̈́̆̄̃͆̀͛́̄̍̎͑̎̽̌̐̾̌͐̓͛̒̐̀̊̀̂̕̚̚̚̚̚͜͝͝͝͝͝͝͝͝͝͝g̶̡̧̨̨̢̡̢̧̨̨̧̛̛͚̞̦̮͖̹̤̜̠̹̭͙̗̫̗̮̘̻̻̩̖̠͔͍̩̻̣̻̞̤̰̼̗̭̠̼̝̘̞̲̰͉̭̙̺̹̮̙̤͖̰̟̣̰̣̞̦͍̝̹̬̤̭̗̤̪̟͇̰̹̫̜̦̦̦͕̙̜̬̱̱̘̱̺̬̝̩̪̲̫̱͙̗̐͗̎̿̄̂̎̀͑̿͗͋̉̍̐͐̒̾̈̓̈̽̑̍̈́̋͗͂͋͊͌̃͊̊̌̓̔̈́̾͐̑͛͐̀̉̌̃̃̾̈̇̍͑̔͊̅̔́͐̎́͊̽̐̊̓̀̃̓̾̂̆̈́̓̾̿̑̈̔̀̎͊̾̉̓̈́͑̈́͋̐͗͊̑̾̐̋̓͌̄̀͋̏̇́̃̓͘̚̚͘͘̚̚͜͜͝͝͝͠͠͠͝͝͝͝ͅͅͅͅơ̶̧̧̡̡̧̧̢̧̨̨̡̢̢̛̛̛̠̱̰̮̞̯̻̲̱̗̰̲̻̣̜̙̜̪̞̜̞̣̪͎̱̠̹̲̝̬̗̜͙͉̦̘̺̱̪̱̬̜̱̪̠̭̬̤͔̥̳̙̬̞̹̭̬̬͈̭̼̠̟͙͖̫̬͉͈̩̼͎̻̫̖̹̼̥̟̣̯̝̰̣̟̝͙̺̬̪͓̟̳̭̝̦͕̺̲̦̅̓̑̓̾̋͂̀̃̒̈̆̊̍̿͋̆̊̏̔͗̈́͂̅̄͛̊̐̈́̽̌͐̓̄̾͒͒̋̑̈́̀́̂̀̈́̌͌̈́̈́͒̃̆̎̎̀̿͆͑̓̀̂̌̉͛͗̂̈̄̂̏̾̋̉̎̋̿̐͑́͊̌̿̉̃̓̌͑̆͐̓͌͗͑̀͂̿̽̑͌͒̐̾̔̿͊͘̚̚̕̕͘̕̚͘͘͜͜͜͝͝͝͝ͅͅͅͅ text.</p>
          <p>Here is a̴̛̛͓̦̳̻̼̭̺̭̞̪̹̟̥͖̼̭̱̻̦̫̭͍̦̥̦̗͗́́͛̽͛̑̈́͒̽͒̈̋͐́͛̒͋̓̂͊̇̇̍̇̓̆̌̂͊̈́̍̈̌̚̚͘͜͠͠͠ n̸̢̨̧̧̢̫̲̼̮̮̲̬̮̝̟̝̱̯̙̤͈̪̠̮̫̺̦̳̤̗̱̦͚̭̲̮̬͙̪̼͈̥̯̙̟̙̘̹̗̗̱͓̫͕̗̦̥̻̱̠̲̹̞̩̲̭͈̝͔̽͐̓͐̓̽̈́̍̄̒͂͂̿͂͌́̈̉̍̍̾͊̅̈́̔̽͑̏̈́̓͗̓̐͌̿̇̈́̎̍͌͊̎́͘̕͘͜͝͝͝ͅǫ̸̢̧̧͇̯̱͇̬̝̹͎̤̮̝̝̪̲̞̪̲̙̯̻̲̟̘̫̱̖̲̱̝̜̘͚̳̺̝͔̦̻͓̪̤̼͚̹̝̮͕̱̹̮͓̱̞̥̥̩̜͔̗̫̈́̈́̅͐͜ţ̷̛̣̙̘͓̣̞̦̤̬̼̹̱̥͔̥̫̹͛̓̄͗̿͂̀͗̈́͆͂̀͗͂̑̐̿͑͐̀̌͊̅̒̀̏̌̌̽̌̓̏͊̅͂̄̌̓͐̈́͊̈́̿͊̎̎̌̅̇̓͑̏͒͒͒̂͂͑̾̑̈́̄̐̾́̓̇̌̏͌̚̚̚̚̕͝͝͝͠͠͝͝͝͝h̷̨̢̨̨̧̨̧̨̧̢̧̛̛̛̛̛̛̜̰̭̯̗̞̖̲̟̞͖͉̝̖̻̪̠̩̜͓͍͓̳̠̹͖̱̬̪̖̜͔̹̺̯̯̖̘͉̜̘̝̼̞̝͚̜̦̝̗̤̫̩̮̺̦̮̞̻̬̮̫͉̙̟̹̭̫̣̹̹̰̮̯̫̼̭̣̮̮̭̖̤̣̜͇͉͙̟̮̫̲̳̯̤̠̼͉̹͙̹͚͍̐̂̒̓͛͂͒̆̐͆̓̑̏͋̈́͑̽̎̌̽̂̓͋̿̒͊̇͛͂͛͊͌͒̿̋̓̑͑̈́̈̓͂̋̑̈́̔͐̀̄̈̌̓̆̾͐͋̐͛̇̓̑̈́̿̀̄͗̄̉͛̉͋̇́͊̏̓̔͌̒͒̂̑̅͗̒͊̑͒̾̓̃̏̌̀̆̐͘͘͘̚̚̚̕̚͘͜͜͜͠͠͝͝͝͝͝ę̴̨̡̧̧̢̡̛̛̛̮̥̠̩̻̼͙̗̺̜̪͉͖͙̺̦̬̰̞̪̘̟̘̟̪̣̫̮̮̠̣̼̬̳̖̳̥̠̮̙̺̼̟̦̦̮̘̹̥̘̤̤̲̯̯̳̼̻̯̪̦̬̥̭̥̝̬̥̙̻̳̹̠͙͚̘̿͂͊̋̓̌̀̿̂̐̇̉̂̿̎̃̉̓̍̍̏̽̋̋̒̈̒͛̏̎̔͆̿̈́̊̓̊́͊̄̂̄͆̾̈́̑̓̓̌̑͂͑̽́̊͊̈́̒̾̌̍̂͗̇̓̀͆̋̃̊̽̇̓͐̄͐̐̄̇̌͒̃̔̃͂̀͋̃̈́́̽̌̚̚̚̚͜͠͝͝͝͝͠͝͝ͅͅͅͅͅͅr̴̢̨̨̧̧̧̢̧̧̦̬̩͉̘̱̥͕̜̩͍͕̝̹̜̬̯͕̭̼̗̠̰̟̭̻̬͙̦̠̱̻̬̱̰̙̰̹̺͉̯̖̳̞̻̺̱̼̖͚̯̙̳̥̭̠̯̦̰̖̲̙͎͔̙̪̪̲̖̘̰̝̟͉͚̫̰̠̙̖͓̬̝̯̿̊͋͆̾͛͑̀͆̒͛͐͑͒̌͛̽̑̋͊͊̓͆̃̕̚͘͜ͅ ̸̺̤̼̮̖̹͙̺͎͔̯̱̫͕̘͚͍̱̱̰͙̟͐̅̽̏̇̅̽̏̇̿̀̏̈͗͠ẗ̵̢̨̡̡̧̛̤̬̗͎̯̳̙̥̜̘̭̻͎̱͈́̆͐̓̓̒̑̒̑͗̉̂̋͂̽̓̈́̓̆͐̓̇͒͛̏̂̔̾̑̊̐͂̄̎͊͌̎̏͐̆̃̓̉̀͛̈̋͘̕̚͝͝ͅę̴̢̧̡̧̛̬̫̙̞̰̯̖̜̹͎̗̜̺̹̜̭̦͍͉̝̖̙̦͎̫̭̰̲̝͙̞͖͖̯͚̻͍̗̜̩͇̱̩̱̱̺̩̬̊͋̍̈̃̾̄͋͐͌̇̊̓̓̾͊͗̋̋̽̅͐͋͊͆̃̾͋̈́̀̌̔̿͐̌͂͐̓̑̔̓̀͋̈́̑̈́̆͆͛̿͗̃̓̈̇͂̿̎̀͗̒̂̂̔̉͂̄͗̓͊̏̉̚͘̕̚̚̕͜͜͝͠͝͝͝͝͠͝͝͝ͅx̶̡̨̨̨̨̧̛̛̙̯̙̬̺̟̖̰̯̥̙̣̬̟̖̮̹̦͙̤̦̼̤̖̱͓̥̳̼͔̮͔̖̺̻̮̻̥̺̱̯̭̠̣̞̺͈͉̲̖͎̙̲̺̜͚̹̹̭͈̬͓̪͔͚͕͔͓̩̳̝͖͚͔̻̹͚̺͈̟̫̺̲͓̼̪̪͉̙̻̰͔̦͇̻̮̖͔͚̱̯̮̝̻̜̱̪̏̉͆̓͋́̿́͐͑̌̓̍͑̈̃͊̓̎̈́̈́̓̂͂̈́̀̋̋̎͂̄̐̏͐̌͊̆͐̃̓̎̓́̍͛̈́̀̈́̃͆̀̿̒͛̄͒̊͗͐̇̏̍͐́̀̎̿̽̽̅͊̉̄͑͑̈͊̿̊̓̂͒̅̿̍͆̎̅̏̾̌̒̍̐̎͌̇̊̄̃̋͛͘̚̚̚̕͘̚͘̚͜͜͜͝͝͝͝͝͝͝͝ͅͅţ̸̧̛̛̱̠̘̲̮̙̟̖̜̼̫̪̱̮̪̪̮͓̝͍̫͍̠̥͍̙̠̠͚̩͓̭̫̻͕̲͚͙̞̞̩͍͉̙̮͔͓͚̹͑̀̒̍̊̌̈́͛̽̆͌̑̓͋͒̀̾̀̇̓͐͐͑̓̓̉̌̉͆̐͑͊̈́̿͐̂̎̊̐̐͂̒̈́͆̋̎͌̓̃̅̽̿̍͑͒̑͐̔͐͂̓͌̊̇͋̓͑̆̑͘̚̚̚͘̚͜͜͜͝͝͝͝ͅͅ for good measure.</p>
        </div>
      </body>
    </html>
    """

    assert_achievement_earned(Zalgo, html)
  end

  test "earns achievement with only one zalgo sequence" do
    html = """
    <html>
      <head>
        <title>One Zalgo Test</title>
      </head>
      <body>
        <div>
          <p>This page contains just one z̸̗̼̞͎̱̭̲̺̙͉̽͛̄͐͗̓̾̀̀͂́͝a̷̧̢̡̨̼̫̪̻͍̰̲͙̗̮̓̈́̔̃̿̔̾͑̚͘͠͝͝l̷̳̭̻̟͓̮̣̠̻̓͐͗͘g̴̡̧̮̘͕̦̘̗͚͙̙̲̓̏̓̀̾͗̏̌̃͘o̴̢̧̡̼͇̝̅̍͑́̽͆͂̀̈̓̐͝͝ word.</p>
        </div>
      </body>
    </html>
    """

    assert_achievement_earned(Zalgo, html)
  end

  test "doesn't earn achievement with no zalgo text" do
    html = """
    <html>
      <head>
        <title>No Zalgo Test</title>
      </head>
      <body>
        <div>
          <p>This page contains no zalgo text at all.</p>
          <p>Just regular Unicode characters here.</p>
        </div>
      </body>
    </html>
    """

    assert_achievement_not_earned(Zalgo, html)
  end

  test "doesn't earn achievement with insufficient combining marks" do
    html = """
    <html>
      <head>
        <title>Insufficient Combining Marks</title>
      </head>
      <body>
        <div>
          <p>This page contains characters with diacritics like ñ, é, ü, ç.</p>
          <p>These aren't zalgo text because they only have one combining mark each.</p>
        </div>
      </body>
    </html>
    """

    assert_achievement_not_earned(Zalgo, html)
  end
end